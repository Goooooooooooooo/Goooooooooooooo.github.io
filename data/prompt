你将根据以下功能要求，对一个 アプリ用の「カラム単位の入力検証・ビジネスルール検証機能」进行全面的技术设计评审，并输出最优实现方案、风险点、注意事项以及改进建议。

请在回答时做到逻辑严谨、结构清晰，并且给出可直接用于开发的方案。

⸻

■ 対象機能の要件
	•	２種類のスクリプト
	•	Input Validation（入力検証）
	•	Business Rule（ビジネスルール）
	•	スクリプト内容は JavaScript で記述される
	•	AI による自動生成機能あり（OpenAI または Claude）
	•	Monaco Editor によるコード編集
	•	３階層の有効・無効フラグ
	•	全体（カラム）
	•	入力検証
	•	ビジネスルール
	•	データ保存先：validation_scripts テーブル
	•	実行タイミング：CRUD 画面のフォーム送信時
	•	バリデーション実行
	•	エラーメッセージ返却・表示

⸻

■ 期待する出力

あなたは ソフトウェアアーキテクト として以下をまとめてください。

1. 機能の本質的な目的の整理

何を解決し、どんな価値があるか。

2. 想定される潜在的危険性（徹底的に）

例：
	•	ユーザー任意 JS 実行の危険性
	•	作用範囲が広いロジックの暴走
	•	XSS / RCE / 無限ループ
	•	パフォーマンスリスク
	•	型不整合によるランタイムエラー
	•	“AI 生成コードの品質不安定性”
	•	デバッグが困難なことによる運用負担
	•	モデルの Hallucination によるスキーマ破壊

可能な限り深堀りして。

3. 実装時に必ず考慮すべき注意点

セキュリティ、DX（Developer Experience）、UX、データモデル、安全なコード実行など。

4. 最適解に近いシステム構成・技術スタック案

フロント/バック双方について
	•	JS sandbox 対策
	•	vm2 / isolated-vm / bun: sandbox
	•	Web Worker 分離
	•	TypeScript 型保証
	•	Monaco Editor の LSP
	•	Lint + AST チェック
	•	OpenAI / Claude のガードレール

など、現実的で安全な構成を提示。

5. 入力検証・ビジネスルールの実行フロー設計
	•	CRUD 送信前に実行
	•	どう安全に評価するか
	•	エラーの扱い
	•	ログ
	•	ステップごとの実行順

6. AI にコードを自動生成させる際の最適プロンプト設計
	•	安全に実行できる JS のスコープ定義
	•	禁止 API の指定
	•	入力例/出力例の提示
	•	“生成→静的解析→実行”のガードレール手順

7. DB テーブルの最適な構造設計

validation_scripts のおすすめ構造
	•	script_type
	•	enabled_hierarchy
	•	versioning
	•	schema snapshot
	•	audit log

8. 運用監視・ログ設計
	•	実行時間
	•	スクリプトエラー
	•	ユーザー編集履歴
	•	AI 生成ログ

9. 改善案 / 代替アーキテクチャ案
	•	完全 No-JS の DSL（Domain Specific Language）化
	•	JSONLogic
	•	Rule Engine
	•	Pythonサーバサイド実行（安全化）

10. 最終的に推奨される“ベストプラクティス案”

今の要件で現実的に作るなら、どの構成がベストか結論を書いてください。

⸻

■ 答え方のトーン
	•	明快・論理的
	•	余計な説明は省き、必要な部分だけ深堀り
	•	ところどころ軽いユーモア OK
	•	専門家のアドバイスとして即使えるレベル
